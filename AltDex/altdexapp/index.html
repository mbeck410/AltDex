<html>
<head>

    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style>

        .center {
            margin: auto;
            width: 60%;
        }

        table.table1 {
            margin: auto;
            width: 60%;
            text-align: center;
        }

        table.table1 td {
            font-size: 50px;
            text-align: center;
        }

        table.table2 {
            margin: auto;
            width: 60%;
        }
        table.table2 tr:nth-child(even) {background-color: #f2f2f2;}

        table.table2 th,td {
            text-align: left;
            border: 0px;
            padding: 0px;
        }


        [v-cloak] {
            display: none;
        }


    </style>
</head>

<body>

<h2 class = "center">Altdex 50</h2>

<div id="index_chart" class="center"></div>

<div id="index_info">
    <div v-cloak>
        <table class="table1">
            <tr>
                <th>Price</th>
                <th>%Chg</th>
            </tr>
            <tr v-for="row in rows">
                <td>{{row.price}}</td>
                <td>{{row.price_percent}}</td>
            </tr>
        </table>
    </div>
</div>

<div id="coin_table">
    <div v-cloak>
        <table class="table2">
            <tr >
                <th>Symbol</th>
                <th>Name</th>
                <th>Market</th>
                <th>Last</th>
                <th>Change</th>
                <th>%Chg</th>
                <th>High</th>
                <th>Low</th>
                <th>Volume</th>
            </tr>
            <tr v-for="row in rows">
                <td>{{row.Symbol}}</td>
                <td>{{row.Name}}</td>
                <td>{{row.Market}}</td>
                <td>{{row.Price}}</td>
                <td>{{row.Change}}</td>
                <td>{{row.percent}}</td>
                <td>{{row.High}}</td>
                <td>{{row.Low}}</td>
                <td>{{row.Volume}}</td>
            </tr>
        </table>
    </div>
</div>

<script>

    let app = new Vue({
        el: '#coin_table',
        data: {
            ascending: false,
            sortColumn: '',
            rows: [],
        }
    });

    let app2 = new Vue({
        el: '#index_info',
        data: {
            ascending: false,
            sortColumn: '',
            rows: [],
        }
    });

    function http_get(url, success) {
        let xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            console.log(this.status);
            if (this.readyState === 4 && this.status === 200) {
                let data = JSON.parse(xhttp.responseText);
                success(data);
            }
        };
        xhttp.open("GET", url);
        xhttp.send();
    }



    function coin_current() {
        app.rows = [];
        let url = '/altdexapp/getcoinscurrent/';  //"{% url 'altdexapp:getcoinscurrent' %}";
        //alert('test');
        http_get(url, function (data) {
            for (let i = 0; i < data.coins_current.length; ++i) {
                app.rows.push(data.coins_current[i]);
            }
        });
    }

    let line_data = [];

    function index_all() {
        let url = '/altdexapp/getindexall/';
        //alert('test');
        http_get(url, function (data) {
            for (let i = 0; i < data.indices_all.length; ++i) {
                line_data.push(data.indices_all[i]);
            }
        });
    }

    function index_current() {
        app2.rows = [];
        let url = '/altdexapp/getindexcurrent/';
        //alert('test');
        http_get(url, function (data) {
            for (let i = 0; i < data.indices_current.length; ++i) {
                app2.rows.push(data.indices_current[i]);
            }
        });
    }

    coin_current();
    index_current();
    index_all();

    let layout = {
      xaxis: {
        title: 'Date',
        autorange: true,
        showgrid: false,
        zeroline: false,
        showline: true,
        autotick: true,
        ticks: '',
        showticklabels: true,
      },
      yaxis: {
        title: 'Price',
        autorange: true,
        showgrid: false,
        autotick: true,
        showline: true,
        ticks: '',
        showticklabels: true,
      },

    };

    Plotly.react('index_chart', line_data, layout);






    //setInterval(coin_current, 15000);





</script>
</body>
</html>


