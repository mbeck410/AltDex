<html>
<head>

    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style>
        @media screen and (max-width: 1020px) {
            /*#index_chart, table.table1, table.table2 {*/
            /*float: none;*/
            /*width: auto;*/
            /*}*/
            #index_chart {
                height: 40%;
                width: auto;
            }
            table.table1 {
                width: 100%;
                float: none;
                table-layout: fixed;
            }
            p{ font-size: 2em; }
        }

        body {
            font-family: "Open Sans", verdana, arial, sans-serif;
        }

        .center {
            margin: auto;
            width: 60%;
        }

        table.table1 {
            margin: auto;
            width: 40%;
            text-align: center;
            table-layout: fixed;
        }

        table.table1 td {
            font-size: 50px;
            text-align: center;
        }

        table.table2 {
            text-align: center;
            border-collapse: collapse;
            margin: auto;
            width: 60%;
        }


        table.table2 tr:nth-child(odd) {background-color: #f1f1f1;}

        table.table2 tr:first-child {background-color: #629fca;}

        table.table2 th,td {
            border: 0px;
            padding: 0px;
        }


        [v-cloak] {
            display: none;
        }


    </style>
</head>

<body>

<h2 class = "center">Altdex 50</h2>

<div id="index_chart" class="center"></div>

<div id="index_info">
    <div v-cloak>
        <table class="table1">
            <tr>
                <th>Price</th>
                <th>%Chg</th>
            </tr>
            <tr v-for="row in rows">
                <td>{{row.price}}</td>
                <td>{{row.price_percent}}</td>
            </tr>
        </table>
    </div>
</div>

<div id="coin_table">
    <div v-cloak>
        <table class="table2">
            <tr >
                <th>Symbol</th>
                <th>Name</th>
                <th>Market</th>
                <th>Last</th>
                <th>Change</th>
                <th>%Chg</th>
                <th>High</th>
                <th>Low</th>
                <th>Volume</th>
            </tr>
            <tr v-for="row in rows">
                <td>{{row.symbol}}</td>
                <td>{{row.coin}}</td>
                <td>{{row.market_cap}}</td>
                <td>{{row.price}}</td>
                <td>{{row.price_change}}</td>
                <td>{{row.price_percent_change}}</td>
                <td>{{row.high}}</td>
                <td>{{row.low}}</td>
                <td>{{row.volume}}</td>
            </tr>
        </table>
    </div>
</div>

<script>

    let app = new Vue({
        el: '#coin_table',
        data: {
            ascending: false,
            sortColumn: '',
            rows: [],
        }
    });

    let app2 = new Vue({
        el: '#index_info',
        data: {
            ascending: false,
            sortColumn: '',
            rows: [],
        }
    });

    function http_get(url, success) {
        let xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            console.log(this.status);
            if (this.readyState === 4 && this.status === 200) {
                let data = JSON.parse(xhttp.responseText);
                success(data);
            }
        };
        xhttp.open("GET", url);
        xhttp.send();
    }



    function coin_current() {
        app.rows = [];
        let url = '/altdex/getcoinscurrent/';  //"{% url 'altdexapp:getcoinscurrent' %}";
        //alert('test');
        http_get(url, function (data) {
            for (let i = 0; i < data.coins_current.length; ++i) {
                app.rows.push(data.coins_current[i]);
                console.log(data.coins_current[i])
            }

        });
    }

    let line_data = [];

    function index_all() {
        let url = '/altdex/getindexall/';
        //alert('test');
        http_get(url, function (data) {
            for (let i = 0; i < data.indices_all.length; ++i) {
                line_data.push(data.indices_all[i]);
            }
        });
    }

    function index_current() {
        app2.rows = [];
        let url = '/altdex/getindexcurrent/';
        //alert('test');
        http_get(url, function (data) {
            for (let i = 0; i < data.indices_current.length; ++i) {
                app2.rows.push(data.indices_current[i]);
                console.log(app2.rows)
            }
        });
    }

    coin_current();
    index_current();
    index_all();


    let layout = {
        fill: '#b3b3ff',
        // paper_bgcolor: '#000099',
        // plot_bgcolor: '#000099',
      xaxis: {
          // color: '#ffffff',
        title: 'Date',
        autorange: true,
        showgrid: false,
        zeroline: false,
        showline: true,
        autotick: true,
        ticks: '',
        showticklabels: true,
      },
      yaxis: {
        // color: '#ffffff',
        title: 'Price',
        autorange: true,
        showgrid: true,
        autotick: true,
        showline: true,
        ticks: '',
        showticklabels: true,
      },
    };

    Plotly.react('index_chart', line_data, layout);






    //setInterval(coin_current, 15000);





</script>
</body>
</html>
